# Remote Desktop Host Agent

This app runs on the Windows machine that will be remotely controlled.

## For End Users (No Clone Flow)

1. Download the `host-app` folder from your release artifact.
2. Double-click `start-agent.bat`.
3. If your publisher included a preconfigured `.env`, no setup is needed.

`start-agent.bat` also registers the `hostapp://` protocol for the current Windows user.
After the first run, the website can launch the app directly with server/host/token params
without terminal commands.

## Build Portable Windows App

Run from this folder:

```powershell
npm install
npm run build:win
```

To generate a release zip directly:

```powershell
npm run build:win:zip
```

Output folder:

`dist/host-app`

It contains:

- `remote-agent.exe`
- `start-agent.bat`
- `.env` (autogenerated from safe template values by default)
- `.env.template`
- `scripts/windowsInputBridge.ps1`

Note: by default the build generates `.env` from the template values (safe for distribution).
If you intentionally want to embed your local `remote-agent/.env` into the bundle, run the build with `REMOTE_AGENT_COPY_ENV=1`.

## .env Keys

- `REMOTE_SERVER_URL` backend URL
- `REMOTE_USE_LOCALHOST` set to `1` to force `http://localhost:5000` when `REMOTE_SERVER_URL` is not set
- `REMOTE_HOST_ID` optional. Leave empty to auto-generate a stable host id for this host machine
- `REMOTE_FPS` frame rate (default 6)
- `REMOTE_PERF_MODE` `auto` (default) or `off`
- `REMOTE_MIN_FPS` minimum FPS in auto mode (default up to 3)
- `REMOTE_ACTIVE_INPUT_FPS` FPS while controller is actively sending input (default up to 3)
- `REMOTE_TYPING_FPS` FPS while keyboard input is active (default up to 2)
- `REMOTE_INPUT_WINDOW_MS` active-input window for adaptive mode (default 1200)
- `REMOTE_TYPING_WINDOW_MS` typing-priority window for adaptive mode (default 2200)
- `REMOTE_SLOW_CAPTURE_MS` capture-duration threshold for temporary backoff (default 450)
- `REMOTE_CONTROL_TOKEN` same token as backend/frontend
- `REMOTE_DISPLAY_ID` optional monitor id to capture (defaults to the display at origin, else first detected display)
- `REMOTE_DEBUG` set to `1` for verbose input-event logging

If cursor movement feels offset or too sensitive on multi-monitor hosts, set `REMOTE_DISPLAY_ID` explicitly to the target monitor id.

Protocol launch overrides are supported:

- `hostapp://launch?server=https://your-backend&hostId=host-abc&token=shared-token`
- Equivalent CLI flags: `--server=... --host-id=... --token=... --display-id=... --fps=...`

When `REMOTE_HOST_ID` is empty (or a placeholder like `host1`), the agent generates one and persists it to `.host-id` near the app (with a user-profile fallback when needed).

If you see an infinite mirror (screen repeated inside itself), the controller UI is being captured on the same host monitor. Use a different controller device/screen, or pick another monitor via `REMOTE_DISPLAY_ID`.
